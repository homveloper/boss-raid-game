# Hot Data Watcher 예제

이 예제는 `nodestorage/v2` 패키지의 Hot Data Watcher 기능을 보여줍니다. Hot Data Watcher는 자주 접근하는 문서를 자동으로 추적하고, MongoDB Change Stream을 사용하여 이러한 "핫" 문서의 변경 사항을 실시간으로 캐시에 반영합니다.

## 주요 기능

1. **접근 패턴 추적**: 문서에 대한 접근 빈도와 최근성을 추적하여 "핫" 문서를 식별합니다.
2. **자동 캐시 동기화**: 자주 접근하는 문서에 대해 MongoDB Change Stream을 설정하여 변경 사항을 자동으로 캐시에 반영합니다.
3. **리소스 최적화**: 모든 문서가 아닌 자주 접근하는 문서만 감시하여 리소스 사용을 최적화합니다.

## 작동 방식

1. `AccessTracker`는 문서 접근 패턴을 추적하고 점수를 계산합니다.
   - 접근 빈도(얼마나 자주 접근하는지)
   - 최근성(얼마나 최근에 접근했는지)
   - 시간에 따른 점수 감소(오래된 접근 패턴의 중요도 감소)

2. `HotDataWatcher`는 높은 점수를 가진 문서에 대해 MongoDB Change Stream을 설정합니다.
   - 주기적으로 감시 대상 목록을 업데이트합니다.
   - 변경 사항이 감지되면 캐시를 자동으로 업데이트합니다.

## 설정 옵션

Hot Data Watcher는 다음과 같은 옵션을 제공합니다:

- `HotDataWatcherEnabled`: Hot Data Watcher 활성화 여부
- `HotDataMaxItems`: 추적할 최대 핫 아이템 수
- `HotDataDecayFactor`: 점수 감소 계수 (0-1)
- `HotDataWatchInterval`: 감시 목록 업데이트 주기
- `HotDataDecayInterval`: 점수 감소 주기

## 예제 실행 방법

1. MongoDB 서버가 실행 중인지 확인합니다.
2. 다음 명령을 실행합니다:

```bash
go run main.go
```

3. 예제는 다음과 같은 작업을 수행합니다:
   - 20개의 테스트 문서를 생성합니다.
   - 일부 문서에 대해 빈번한 접근 패턴을 시뮬레이션합니다.
   - Hot Data Watcher가 자주 접근하는 문서를 감지하고 감시합니다.
   - MongoDB에서 직접 문서를 업데이트하여 캐시 동기화를 테스트합니다.

## 성능 고려 사항

- Hot Data Watcher는 자주 접근하는 문서만 감시하므로 리소스 사용을 최적화합니다.
- 접근 패턴이 변경되면 감시 대상 목록도 자동으로 업데이트됩니다.
- 점수 감소 메커니즘을 통해 최근 접근 패턴에 더 높은 가중치를 부여합니다.

## 실제 사용 시나리오

- 게임 서버에서 활성 플레이어의 인벤토리 데이터
- 자주 접근하는 길드 또는 클랜 데이터
- 인기 있는 상점 아이템 또는 게시판 게시물
